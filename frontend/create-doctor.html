<script src="js/core.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="css/styles.css">
<script>
    checkIfUserIs('admin').then(isAdmin => {
        if (!isAdmin) {
            redirectTo('/profile');
        }
    });
</script>
<title> Welcome </title>
<nav class="bg-white border-gray-200 dark:bg-gray-900">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
        <div class="hidden w-full md:block md:w-auto" id="navbar-default">
            <ul class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
                <li>
                    <a id="dashboard-item"
                       class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Dashboard</a>
                </li>
                <li>
                    <a href="/profile"
                       class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Profile</a>
                </li>
                <li>
                    <a href="/"
                       class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Home</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<h2 class="font-bold text-3xl m-5">Create Doctor</h2>
<form id="doctor-form"
      class="block mx-5 p-5 border
             rounded border-gray-600 bg-gray-800 space-y-5 ">
    <table class="w-full border-spacing-y-5 border-separate">
        <!-- Email -->
        <tr >
            <td class="pr-4 ">
                <label for="email" class="text-white font-bold">Email</label>
            </td>
            <td>
                <input type="email"
                       id="email"
                       name="email"
                       placeholder="hamza@utku.com"
                       class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 outline-none"
                       required>
            </td>
        </tr>
        <!-- Password -->
        <tr>
            <td class="pr-4">
                <label for="password" class="text-white font-bold">Password</label>
            </td>
            <td>
                <input type="password"
                       id="password"
                       name="password"
                       placeholder="secret"
                       class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 outline-none"
                       required>
            </td>
        </tr>
        <!-- First Name -->
        <tr>
            <td class="pr-4">
                <label for="firstName" class="text-white font-bold">First Name</label>
            </td>
            <td>
                <input type="text"
                       id="firstName"
                       name="firstName"
                       placeholder="Hamza"
                       class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 outline-none"
                       required>
            </td>
        </tr>
        <!-- Last Name -->
        <tr>
            <td class="pr-4">
                <label for="lastName" class="text-white font-bold">Last Name</label>
            </td>
            <td>
                <input type="text"
                       id="lastName"
                       name="lastName"
                       placeholder="DAÅžAR"
                       class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 outline-none"
                       required>
            </td>
        </tr>
        <!-- Expertises (Multiple) -->
        <tr>
            <td class="pr-4 align-top">
                <label for="expertises" class="text-white font-bold">Expertises</label>
            </td>
            <td>
                <select id="expertises"
                        name="expertises"
                        multiple
                        required
                        class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 outline-none">
                    <!-- Options will be added by script -->
                </select>
                <p class="text-xs text-gray-400">
                    Hold Ctrl (Windows) or Cmd (Mac) to select multiple
                </p>
            </td>
        </tr>
        <!-- Work Times -->
        <tr>
            <td class="pr-4 align-top">
                <label for="workstart" class="text-white font-bold">Work Hours</label>
            </td>
            <td class="text-white">
                <div>
                    <label for="workstart" class="mr-2 my-2">Start Time</label>
                    <input type="time" id="workstart" name="workstart" class=" bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label for="workend" class="mr-2">End Time &nbsp;</label>
                    <input type="time" id="workend" name="workend" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 outline-none">
                </div>
            </td>
        </tr>
        <!-- Submit -->
        <tr>
            <td colspan="2" class="pt-4">
                <button
                        class="inline-block text-white bg-blue-700 hover:bg-blue-800
                           focus:ring-4 focus:ring-blue-300 font-medium
                           rounded-lg text-sm px-5 py-2.5 me-2
                           dark:bg-blue-600 dark:hover:bg-blue-700
                           focus:outline-none dark:focus:ring-blue-800"
                        type="submit">
                    Register Doctor
                </button>
            </td>
        </tr>
    </table>
</form>

<script>

    (async () => {
        const user = await getUserProfile();
        switch (user.role) {
            case 'patient':
                document.getElementById('dashboard-item').href = '/patient-dashboard';
                break;
            case 'doctor':
                document.getElementById('dashboard-item').href = '/doctor-dashboard';
                break;
            case 'admin':
                document.getElementById('dashboard-item').href = '/admin-dashboard';
                break;
            default:
                document.getElementById('dashboard-item').href = '/profile';
        }
    })();
    (async () => {
        const expertises = await getAllExpertises();
        const expertisesSelector = document.getElementById('expertises');
        expertises.forEach(expertise => {
            const option = document.createElement('option');
            option.value = expertise.name;
            option.textContent = expertise.name;
            expertisesSelector.appendChild(option);
        });
    })();

    document.getElementById('doctor-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formdata = getDoctorFormDatas()
        if (formdata === undefined)
            return;

        try {
            await createDoctor({
                "email": formdata.email,
                "password": document.getElementById('password').value,
                "firstName": formdata.firstName,
                "lastName": formdata.lastName,
                "role": "doctor",
                "expertises": formdata.expertises,
                "workPlan": formdata.workPlan
            });
            redirectTo('/patient-dashboard');
        } catch (error) {
            alert('Appointment failed: ' + error.message);
        }
    });



</script>